<%= turbo_frame_tag "geography" do %>
  <div class="geography-section">
    <div class="geo-grid">
      <!-- Cities Table -->
      <div class="geo-table-container">
        <h4 class="geo-table-title">Top Orașe</h4>
        <table class="geo-table">
          <thead>
            <tr>
              <th>Oraș</th>
              <th>Vizitatori</th>
              <th>%</th>
            </tr>
          </thead>
          <tbody>
            <% @top_cities.each do |city, count| %>
              <tr>
                <td class="city-name">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="location-icon">
                    <path fill-rule="evenodd" d="M9.69 18.933l.003.001C9.89 19.02 10 19 10 19s.11.02.308-.066l.002-.001.006-.003.018-.008a5.741 5.741 0 00.281-.14c.186-.096.446-.24.757-.433.62-.384 1.445-.966 2.274-1.765C15.302 14.988 17 12.493 17 9A7 7 0 103 9c0 3.492 1.698 5.988 3.355 7.584a13.731 13.731 0 002.273 1.765 11.842 11.842 0 00.976.544l.062.029.018.008.006.003zM10 11.25a2.25 2.25 0 100-4.5 2.25 2.25 0 000 4.5z" clip-rule="evenodd" />
                  </svg>
                  <%= city %>
                </td>
                <td class="city-count"><%= number_with_delimiter(count) %></td>
                <td class="city-percent"><%= ((count.to_f / @total_visitors) * 100).round(1) %>%</td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>

      <!-- Countries Table -->
      <div class="geo-table-container">
        <h4 class="geo-table-title">Top Țări</h4>
        <table class="geo-table">
          <thead>
            <tr>
              <th>Țară</th>
              <th>Vizitatori</th>
              <th>%</th>
            </tr>
          </thead>
          <tbody>
            <% @top_countries.each do |country, count| %>
              <tr>
                <td class="country-name">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="location-icon">
                    <path d="M10.75 10.818v2.614A3.13 3.13 0 0011.888 13c.482-.315.612-.648.612-.875 0-.227-.13-.56-.612-.875a3.13 3.13 0 00-1.138-.432zM8.33 8.62c.053.055.115.11.184.164.208.16.46.284.736.363V6.603a2.45 2.45 0 00-.35.13c-.14.065-.27.143-.386.233-.377.292-.514.627-.514.909 0 .184.058.39.202.592.037.051.08.102.128.152z" />
                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-6a.75.75 0 01.75.75v.316a3.78 3.78 0 011.653.713c.426.33.744.74.925 1.2a.75.75 0 01-1.395.55 1.35 1.35 0 00-.447-.563 2.187 2.187 0 00-.736-.363V9.3c.698.093 1.383.32 1.959.696.787.514 1.29 1.27 1.29 2.13 0 .86-.504 1.616-1.29 2.13-.576.377-1.261.603-1.96.696v.299a.75.75 0 11-1.5 0v-.3c-.697-.092-1.382-.318-1.958-.695-.482-.315-.857-.717-1.078-1.188a.75.75 0 111.359-.636c.08.173.245.376.54.569.313.205.706.353 1.138.432v-2.748a3.782 3.782 0 01-1.653-.713C6.9 9.433 6.5 8.681 6.5 7.875c0-.805.4-1.558 1.097-2.096a3.78 3.78 0 011.653-.713V4.75A.75.75 0 0110 4z" clip-rule="evenodd" />
                  </svg>
                  <%= country %>
                </td>
                <td class="country-count"><%= number_with_delimiter(count) %></td>
                <td class="country-percent"><%= ((count.to_f / @total_visitors) * 100).round(1) %>%</td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <style>
    .geography-section {
      padding: 1rem 0;
    }

    .geo-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: 2rem;
    }

    .geo-table-container {
      background: #f9fafb;
      border-radius: 0.5rem;
      padding: 1.25rem;
    }

    .geo-table-title {
      font-size: 1rem;
      font-weight: 600;
      color: #1f2937;
      margin-bottom: 1rem;
    }

    .geo-table {
      width: 100%;
      border-collapse: collapse;
    }

    .geo-table thead th {
      text-align: left;
      font-size: 0.75rem;
      font-weight: 600;
      color: #6b7280;
      text-transform: uppercase;
      padding: 0.5rem;
      border-bottom: 2px solid #e5e7eb;
    }

    .geo-table tbody tr {
      border-bottom: 1px solid #e5e7eb;
      transition: background 0.2s;
    }

    .geo-table tbody tr:hover {
      background: white;
    }

    .geo-table tbody td {
      padding: 0.75rem 0.5rem;
      font-size: 0.875rem;
    }

    .city-name,
    .country-name {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-weight: 500;
      color: #374151;
    }

    .location-icon {
      width: 1rem;
      height: 1rem;
      color: #3b82f6;
      flex-shrink: 0;
    }

    .city-count,
    .country-count {
      font-weight: 600;
      color: #1f2937;
    }

    .city-percent,
    .country-percent {
      color: #6b7280;
      font-size: 0.8125rem;
    }

    @media (max-width: 768px) {
      .geo-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
<% end %>
