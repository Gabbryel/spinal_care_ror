<% if current_page?("/dashboard/servicii-medicale/#{@specialty.slug}") %>
<div class="specialty-services-dashboard" data-controller="tooltip">
  <div class="specialty-services-header">
    <div class="header-top">
      <%= link_to '/dashboard/servicii-medicale', class: 'back-button' do %>
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5L8.25 12l7.5-7.5" />
        </svg>
        Înapoi la specialități
      <% end %>
      <button class="add-service-btn" data-bs-toggle="modal" data-bs-target="#newMedicalServiceModal">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
        </svg>
        Serviciu nou
      </button>
    </div>
    
    <div class="specialty-title">
      <% if @specialty.photo.attached? %>
        <%= cl_image_tag @specialty.photo.key, width: 60, height: 60, crop: :fill, class: 'specialty-photo' %>
      <% end %>
      <div>
        <h1><%= @specialty.name %></h1>
        <p class="service-count"><%= @specialty.medical_services.count %> <%= @specialty.medical_services.count == 1 ? 'serviciu medical' : 'servicii medicale' %></p>
      </div>
    </div>
  </div>

  <%= render partial: 'medical_services/modal', locals: {new: true, modal_id: "newMedicalServiceModal", title: "Adaugă serviciu medical", medical_service: @medical_service} %>

  <div class="specialty-tabs">
    <% Specialty.all.sort_by { |s| s.name }.each do |s| %>
      <%= link_to s.name, admin_specialty_path(s), class: "specialty-tab #{s.id == @specialty.id ? 'active' : ''}" %>
    <% end %>
  </div>

  <% general_services = @specialty.medical_services.select { |ms| ms.member == nil }.sort_by { |ms| ms.name } %>
  <% specialist_services = selected_and_sorted_medical_services(@specialty) %>

  <% if general_services.any? %>
    <div class="services-section">
      <h2 class="section-title">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" d="M9.568 3H5.25A2.25 2.25 0 003 5.25v4.318c0 .597.237 1.17.659 1.591l9.581 9.581c.699.699 1.78.872 2.607.33a18.095 18.095 0 005.223-5.223c.542-.827.369-1.908-.33-2.607L11.16 3.66A2.25 2.25 0 009.568 3z" />
          <path stroke-linecap="round" stroke-linejoin="round" d="M6 6h.008v.008H6V6z" />
        </svg>
        Servicii generale
      </h2>
      <div class="services-grid">
        <% general_services.each do |ms| %>
          <%= render partial: 'medical_services/service_card', locals: { medical_service: ms } %>
        <% end %>
      </div>
    </div>
  <% end %>

  <% if specialist_services.any? %>
    <div class="services-section">
      <h2 class="section-title">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z" />
        </svg>
        Servicii pe specialist
      </h2>
      <% specialist_services.each_with_index do |ms, i| %>
        <% if i == 0 || ms.member != specialist_services[i-1].member %>
          <div class="specialist-header">
            <% if ms.member.photo.attached? %>
              <%= cl_image_tag ms.member.photo.key, width: 40, height: 40, crop: :fill, gravity: :face, class: 'specialist-photo' %>
            <% end %>
            <h3>
              <%= link_to "echipa/#{ms.member.slug}", target: '_blank' do %>
                <%= ms.member.academic_title %> <%= ms.member.name %>
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 6H5.25A2.25 2.25 0 003 8.25v10.5A2.25 2.25 0 005.25 21h10.5A2.25 2.25 0 0018 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25" />
                </svg>
              <% end %>
            </h3>
          </div>
          <div class="services-grid">
        <% end %>
        <%= render partial: 'medical_services/service_card', locals: { medical_service: ms } %>
        <% if i == specialist_services.length - 1 || specialist_services[i+1].member != ms.member %>
          </div>
        <% end %>
      <% end %>
    </div>
  <% end %>

  <% if general_services.empty? && specialist_services.empty? %>
    <div class="empty-state">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" d="M9.568 3H5.25A2.25 2.25 0 003 5.25v4.318c0 .597.237 1.17.659 1.591l9.581 9.581c.699.699 1.78.872 2.607.33a18.095 18.095 0 005.223-5.223c.542-.827.369-1.908-.33-2.607L11.16 3.66A2.25 2.25 0 009.568 3z" />
        <path stroke-linecap="round" stroke-linejoin="round" d="M6 6h.008v.008H6V6z" />
      </svg>
      <p>Niciun serviciu medical adăugat pentru această specialitate</p>
      <button class="empty-state-btn" data-bs-toggle="modal" data-bs-target="#newMedicalServiceModal">Adaugă primul serviciu</button>
    </div>
  <% end %>
</div>
<% else %>
      <%= no_access %>
  <% end %>
